{
  "name": "Calculator Main Flow",
  "nodes": [
    {
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "parameters": {
        "path": "calculate",
        "httpMethod": "POST"
      }
    },
    {
      "name": "Validate Data",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "jsCode": "// Validación rápida\nconst data = $json.body;\nif (!data.procedimiento || !data.resultados) {\n  throw new Error('Datos incompletos');\n}\ndata.id = Date.now().toString();\ndata.timestamp = new Date().toISOString();\nreturn { json: data };"
      }
    },
    {
      "name": "Classify Impact",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "jsCode": "const ahorro = $json.resultados.ahorroAnual;\nlet nivel = 'BAJO';\nif (ahorro > 50000) nivel = 'ALTO';\nelse if (ahorro > 10000) nivel = 'MEDIO';\n$json.clasificacion = nivel;\nreturn { json: $json };"
      }
    },
    {
      "name": "Save to CSV",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "jsCode": "const fs = require('fs');\nconst csvLine = `${$json.id},${$json.timestamp},${$json.procedimiento},${$json.servicio || 'N/A'},${$json.usuario || 'Anónimo'},${$json.resultados.ahorroAnual},\"${JSON.stringify($json).replace(/\"/g, '\"\"')}\"\n`;\nfs.appendFileSync('/data/calculos.csv', csvLine);\nreturn { json: $json };"
      }
    }
  ]
}
